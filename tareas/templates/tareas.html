{% extends 'base.html' %}

{% block content %}   


<div class="row">
    <div class="col-md-12">
        <div class="tile row">
            <div class="col-md-3 " style="padding: 20px;">
                <div id="external-events">
                    <h3 class="mb-4">Tareas Pendientes</h3>
                    {% for event in events_month %}
                      <div class="fc-event">
                          <h4>{{ event.titulo }}</h4>
                          <p>{{ event.descripcion }}</p>
                          <p>Desde: {{ event.fecha_inicio }}</p>
                          <p>Hasta: {{ event.fecha_fin }}</p>
                          <hr>
                      </div>
                    {% empty %}
                      <p>No hay Tareas para mostrar</p>
                    {% endfor %}
                </div>
            </div>
            <div class="col-md-9">
                <div id="calendar" class="container" style="padding: 20px;"></div>
            </div>
            <script>

              document.addEventListener('DOMContentLoaded', function() {
                var today = new Date();
                var calendarEl = document.getElementById('calendar');
                var calendar = new FullCalendar.Calendar(calendarEl, {
                  initialView: 'dayGridMonth',
                  headerToolbar: {
                      left: 'prev,next today',
                      center: 'title',
                      right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
                    },
                  initialDate: today,
                  navLinks: true, // can click day/week names to navigate views
                  businessHours: true, // display business hours
                  editable: true,
                  selectable: true,
                  selectMirror: true,
                  selectHelper: true,
                  eventLimit: true,
                  dayMaxEvents: true, // allow "more" link when too many events
                  editable: true,
                  dayMaxEvents: true, // allow "more" link when too many events
                  events: [
                      {% for tarea in events %}
                      {
                        title: '{{tarea.titulo}}',
                        start: '{{tarea.fecha_inicio | date:"Y-m-d"}}',
                        end: '{{tarea.fecha_fin | date:"Y-m-d"}}',
                      },
                      {% endfor %}
                    ],
                  
                                      
                  select: function (start, end, allDay) {
                    var title = prompt("Ingrese Titulo de la Tarea");
                    if (title) {
                        var start = $.fullCalendar.formatDate(start, "Y-MM-DD HH:mm:ss");
                        var end = $.fullCalendar.formatDate(end, "Y-MM-DD HH:mm:ss");
                        $.ajax({
                            type: "GET",
                            url: '/add_event',
                            data: {'title': title, 'start': start, 'end': end},
                            dataType: "json",
                            success: function (data) {
                                calendar.fullCalendar('refetchEvents');
                                alert("Tarea Agragada Satisfactoriamente");
                            },
                            error: function (data) {
                                alert('Hay un Problema!!!');
                            }
                        });
                    }
                  },
                  eventResize: function (event) {
                    var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
                    var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
                    var title = event.title;
                    var id = event.id;
                    $.ajax({
                        type: "GET",
                        url: '/update',
                        data: {'title': title, 'start': start, 'end': end, 'id': id},
                        dataType: "json",
                        success: function (data) {
                            calendar.fullCalendar('refetchEvents');
                            alert('Tarea Actualizada');
                        },
                        error: function (data) {
                            alert('Hay un Problema!!!');
                        }
                    });
                  },
      
                  eventDrop: function (event) {
                    var start = $.fullCalendar.formatDate(event.start, "Y-MM-DD HH:mm:ss");
                    var end = $.fullCalendar.formatDate(event.end, "Y-MM-DD HH:mm:ss");
                    var title = event.title;
                    var id = event.id;
                    $.ajax({
                        type: "GET",
                        url: '/update',
                        data: {'title': title, 'start': start, 'end': end, 'id': id},
                        dataType: "json",
                        success: function (data) {
                            calendar.fullCalendar('refetchEvents');
                            alert('Tarea Actualizada');
                        },
                        error: function (data) {
                            alert('Hay un Problema!!!');
                        }
                    });
                  },
      
                  eventClick: function (event) {
                    if (confirm("Esta Usted seguro de Eliminar esta Tarea?")) {
                        var id = event.id;
                        $.ajax({
                            type: "GET",
                            url: '/remove',
                            data: {'id': id},
                            dataType: "json",
                            success: function (data) {
                                calendar.fullCalendar('refetchEvents');
                                alert('Tarea Eliminada');
                            },
                            error: function (data) {
                                alert('Hay un Problema!!!');
                            }
                        });
                    }
                  },

                });
                calendar.render();
                calendar.setOption('locale', 'es');
              });
        
            </script>

        </div>
    </div>
</div>


{% endblock content %}







{% extends 'base.html' %}

{% block content %}   

{% load crispy_forms_tags %}

<br>
<div class="container bg-light card shadow-md p-5 shadow p-3 mb-5 form-layout">
                
    <h1 class="text-center">Registro Antropométrico</h1>
    <h5 class="text-center">Agrege los datos requerido para su registro</h5>
    <hr>


    {{error}}


    <div class="tabcontent" id="metric">

        <div class="col-12 text-center">
            <strong> NOMBRE DEL MENOR EN CONSULTA</strong>
            <div class="col-12 text-center">
                {{menor_detalles}}
            </div>
            <br>
        </div>

            <div class="row">
                <div class="col-4">
                    <P> <strong> Peso: </strong> {{imc_menores.peso}} </p>
                </div>

                <div class="col-4">
                    <P> <strong> Talla: </strong> {{imc_menores.talla}} </p>
                </div>

                <div class="col-4">
                    <P> <strong> CBI: </strong> {{imc_menores.cbi}} </p>
                </div>
            </div>

    </div>

    {% if imc_menores.imc %}
        <div class="row">
            <div class="row">
                <div class="col-sm-6">
                    <div id="main" style="width: 400px;height:300px;"></div>

                    <script type="text/javascript">
                        var datos = {{imc}};
                        var chartDom = document.getElementById('main');
                        var myChart = echarts.init(chartDom);
                        var option;

                        option = {
                          series: [
                            {
                              type: 'gauge',
                              startAngle: 180,
                              endAngle: 0,
                              center: ['50%', '75%'],
                              radius: '130%',
                              min: 15,
                              max: 33,
                              splitNumber: 8,
                              axisLine: {
                                lineStyle: {
                                  width: 25,
                                  color: [
                                    [0.19, '#dc3545'],
                                    [0.44, '#198754'],
                                    [0.55, '#ffc107'],
                                    [0.833, '#FF7F50'],
                                    [1, '#dc3545']
                                    
                                  ]
                                }
                              },
                              pointer: {
                                icon: 'path://M12.8,0.7l12,40.1H0.7L12.8,0.7z',
                                length: '15%',
                                width: 30,
                                offsetCenter: [0, '-60%'],
                                itemStyle: {
                                  color: 'auto'
                                }
                              },
                              axisTick: {
                                length: 12,
                                lineStyle: {
                                  color: 'auto',
                                  width: 2
                                }
                              },
                              splitLine: {
                                length: 20,
                                lineStyle: {
                                  color: 'auto',
                                  width: 5
                                }
                              },
                              axisLabel: {
                                color: '#464646',
                                fontSize: 12,
                                distance: -45,
                                rotate: 'tangential',
                                formatter: function (value) {
                                  if (value === 30) {
                                    return 'OBESIDAD';
                                  } else if (value === 28) {
                                    return 'SOBREPESO';
                                  } else if (value === 25) {
                                    return 'RIESGO DE SOBREPESO';
                                  } else if (value === 23) {
                                    return 'ADECUADO';
                                  } else if (value === 18) {
                                    return 'PESO BAJO';
                                  }
                                  return '';
                                }
                              },
                              title: {
                                offsetCenter: [0, '-10%'],
                                fontSize: 25
                              },
                              detail: {
                                fontSize: 50,
                                offsetCenter: [0, '-35%'],
                                valueAnimation: true,
                                color: 'inherit'
                              },
                              data: [
                                {
                                  value: datos,
                                  name: 'IMC Kg/m²'
                                }
                              ]
                            }
                          ]
                        };

                        option && myChart.setOption(option);

                        
                    </script>


                </div>

            </div>

            <div  class="col-6 text-center" >
                <p class="text-center"><strong>DIAGN. PESO</strong></p>
                {% if imc_menores.diagnostico == "DNT AGUDA SEVERA" %}
                    <div class="text-bg-danger p-1">DNT AGUDA SEVERA</div>  
                {%elif imc_menores.diagnostico == "DNT AGUDA MODERADA" %}
                    <div class="text-white p-1"style="background-color:#FF7F50">DNT AGUDA MODERADA</div>  
                {%elif imc_menores.diagnostico == "RIESGO DNT AGUDA" %}
                    <div class="text-bg-warning p-1">RIESGO DNT AGUDA</div>  
                {%elif imc_menores.diagnostico == "PESO ADECUADO" %}
                    <div class="text-bg-success p-1">PESO ADECUADO</div>
                {%elif imc_menores.diagnostico == "RIESGO DE SOBREPESO" %}
                    <div class="text-bg-warning p-1">RIESGO DE SOBREPESO</div>
                {%elif imc_menores.diagnostico == "SOBREPESO" %}
                    <div class="text-white p-1"style="background-color:#FF7F50">SOBREPESO</div>
                {%elif imc_menores.diagnostico == "OBESIDAD" %}
                    <div class="text-bg-danger p-1">OBESIDAD</div>
                {% endif %}
            </div>
            
            <div  class="col-6 text-center" >
                <p class="text-center"><strong>DIAGN. TALLA</strong></p>
                {% if imc_menores.diagnostico_talla == "TALLA BAJA" %}
                    <div class="text-bg-danger p-1">TALLA BAJA</div>  
                {%elif imc_menores.diagnostico_talla == "RIESGO TALLA BAJA" %}
                    <div class="text-bg-warning p-1">RIESGO TALLA BAJA</div>  
                {%elif imc_menores.diagnostico_talla == "TALLA NORMAL" %}
                    <div class="text-bg-success p-1">TALLA NORMAL</div>  
                {%elif imc_menores.diagnostico_talla == "RIESGO TALLA ALTA" %}
                    <div class="text-bg-warning p-1">RIESGO TALLA ALTA</div>
                {%elif imc_menores.diagnostico_talla == "TALLA ALTA" %}
                    <div class="text-bg-info p-1">TALLA ALTA</div>
                {% endif %}
            </div>


        </div>
        <br>

        <form action="imc_menor_riesgo" method="POST">
            {% csrf_token %}
    
            <div class="row justify-content-center">
                <div class="col-5 text-center">
                    <label for="riesgo"><strong>Presenta Riesgo:</strong></label>
                    <select id="riesgo" name="riesgo">
                        <option value="NO" selected>NO</option>
                        <option value="SI">SI</option>
                    </select>
                </div>
            </div> 
            
            <div class="row">
                <div class="col">
                    <br>
                    <label for="servicio">Servicio:</label>
                    <textarea name="servicio" rows="6" cols="12"></textarea>
                </div>
                <div class="col">
                    <br>
                    <label for="centro_hospital">Centro:</label>
                    <textarea name="centro_hospital" rows="6" cols="12"></textarea>
                </div>
                <div class="col">
                    <br>
                    <label for="observacion">Observación:</label>
                    <textarea name="observacion" rows="6" cols="12"></textarea>
                </div>
            </div> 
            
            <br>
            <button type="submit" class="btn btn-primary" action="{% url 'menor_detalle' pk id %}">Aceptar </button>

        </form>


    {% endif %}

</div>

{% endblock %}